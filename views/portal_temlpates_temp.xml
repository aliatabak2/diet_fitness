<?xml version="1.0" encoding="utf-8"?>
<odoo>

  







  <!-- DASHBOARD -->
  <template id="portal_my_diet" name="Diet: Dashboard">
    <t t-call="portal.portal_layout">
      <t t-set="breadcrumbs_searchbar" t-value="True"/>
      <div class="o_portal_wrap container py-4">
        <h2 class="mb-3">Diyetim</h2>

       <small class="text-muted">
  <t t-if="p.workout_id">
    <!-- eskisi (hata veriyor): Süre: <t t-esc="p.workout_id.duration_min or 0"/> dk -->
    Zorluk: <t t-esc="p.workout_id.difficulty or '-'"/>
  </t>
  <t t-else="">
    Lütfen antrenman seçiniz.
  </t>
</small>

        <t t-if="not member">
          <div class="alert alert-warning">Bu portal hesabına bağlı üye bulunamadı.</div>
        </t>

        <t t-if="member">
          <div class="row g-3 mb-4">
            <div class="col-12 col-lg-6">
              <div class="card h-100">
                <div class="card-header">Son Günlük Planlar</div>
                <ul class="list-group list-group-flush">
                  <t t-foreach="plans" t-as="p">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <a t-attf-href="/my/diet/plan/#{p.id}">
                        <t t-esc="p.date or ''"/>
                      </a>
                      <span class="badge bg-light text-dark">
                        <t t-esc="sum(p.meal_line_ids.mapped('kcal'))"/> kcal
                      </span>
                    </li>
                  </t>
                  <t t-if="not plans">
                    <li class="list-group-item text-muted">Plan bulunamadı.</li>
                  </t>
                </ul>
              </div>
            </div>
           

            <div class="col-12 col-lg-6">
              <div class="card h-100">
                <div class="card-header">Dönemler</div>
                <ul class="list-group list-group-flush">
                  <t t-foreach="periods" t-as="pr">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <a t-attf-href="/my/diet/period/#{pr.id}">
                        <t t-esc="pr.name"/>
                      </a>
                      <span class="badge bg-secondary"><t t-esc="pr.state"/></span>
                    </li>
                  </t>
                  <t t-if="not periods">
                    <li class="list-group-item text-muted">Dönem yok.</li>
                  </t>
                </ul>
              </div>
            </div>
          </div>

          <div>
            <a class="btn btn-outline-primary me-2" href="/my/diet/periods">
              <i class="fa fa-calendar me-1"/> Dönemlerim
            </a>
            <a class="btn btn-outline-secondary" href="/my/diet/recipes">
              <i class="fa fa-cutlery me-1"/> Tarifler
            </a>
          </div>
        </t>
      </div>
    </t>
  </template>

  <!-- PLAN DETAY -->
 <template id="portal_diet_plan" name="Diet: Plan Detail">
  <t t-call="portal.portal_layout">
    <div class="container py-4">
      <a href="/my/diet" class="btn btn-link">← Geri</a>
      <h3 class="mb-3">Günlük Plan — <t t-esc="plan.date"/></h3>

      <div class="mb-3">
        <!-- POST + CSRF -->
        <form t-attf-action="/my/diet/plan/#{ plan.id }/regen" method="post" class="d-inline">
  <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
  <button type="submit" class="btn btn-primary">
    <i class="fa fa-refresh me-1"/> Yeniden Oluştur
  </button>
</form>


      </div>

      <div class="card">
        <div class="card-header d-flex justify-content-between">
          <span>Öğünler</span>
          <span class="text-muted">
            Toplam: <t t-esc="total_kcal"/> kcal
          </span>
        </div>
        <ul class="list-group list-group-flush">
          <t t-foreach="plan.meal_line_ids" t-as="ml">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong t-esc="ml.meal_type.capitalize()"/> — <span t-esc="ml.recipe_id.name or 'Seçilmedi'"/>
                <small class="text-muted ms-2" t-esc="ml.note or ''"/>
              </div>
              <span class="badge bg-light text-dark"><t t-esc="ml.kcal or 0"/> kcal</span>
            </li>
          </t>
          <t t-if="not plan.meal_line_ids">
            <li class="list-group-item text-muted">Öğün bulunamadı.</li>
          </t>
        </ul>
      </div>
    </div>
  </t>
</template>


  <!-- DÖNEM LİSTESİ -->
  <template id="portal_period_list" name="Diet: Period List">
    <t t-call="portal.portal_layout">
      <div class="container py-4">
        <a href="/my/diet" class="btn btn-link">← Geri</a>
        <h3>Dönemler</h3>
        <div class="list-group">
          <t t-foreach="periods" t-as="pr">
            <a t-attf-href="/my/diet/period/#{pr.id}" class="list-group-item list-group-item-action d-flex justify-content-between">
              <span t-esc="pr.name"/>
              <span class="badge bg-secondary" t-esc="pr.state"/>
            </a>
          </t>
          <t t-if="not periods">
            <div class="text-muted">Henüz dönem yok.</div>
          </t>
        </div>
      </div>
    </t>
  </template>

  <!-- DÖNEM DETAY -->
  <template id="portal_period_detail" name="Diet: Period Detail">
    <t t-call="portal.portal_layout">
      <div class="container py-4">
        <a href="/my/diet/periods" class="btn btn-link">← Geri</a>
        <h3 class="mb-3" t-esc="period.name"/>
        <div class="mb-3">
          <form t-attf-action="/my/diet/period/#{period.id}/generate13" method="post">
            <button class="btn btn-primary">
              <i class="fa fa-magic me-1"/> 13 Günü Üret
            </button>
            <a t-attf-href="/my/diet/shopping-list/#{period.id}" class="btn btn-outline-secondary ms-2">
              <i class="fa fa-shopping-basket me-1"/> Alışveriş Listesi
            </a>
          </form>
        </div>

        <div class="card">
          <div class="card-header">Günler</div>
          <ul class="list-group list-group-flush">
            <t t-foreach="days" t-as="p">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <a t-attf-href="/my/diet/plan/#{p.id}">
                  <t t-esc="p.date"/>
                </a>
                <span class="text-muted"><t t-esc="sum(p.meal_line_ids.mapped('kcal'))"/> kcal</span>
              </li>
            </t>
            <t t-if="not days">
              <li class="list-group-item text-muted">Gün eklenmemiş.</li>
            </t>
          </ul>
        </div>
      </div>
    </t>
  </template>

<template id="portal_workout_list_v2" name="Diet: Workout List v2">
  <t t-call="portal.portal_layout">
    <div class="container py-4">
      <h3 class="mb-3">Sporum</h3>
      <t t-if="not plans">
        <div class="alert alert-info">Gösterilecek antrenman bulunamadı.</div>
      </t>
      <div class="list-group">
        <t t-foreach="plans" t-as="p">
          <a t-attf-href="/my/diet/workout/#{p.id}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-semibold">
                <t t-esc="p.date"/> —
                <t t-esc="p.workout_id and p.workout_id.name or 'Spor tanımlı değil'"/>
              </div>
              <small class="text-muted">
                <t t-if="p.workout_id">
                  Antrenman atanmış.
                </t>
                <t t-else="">Lütfen antrenman seçiniz.</t>
              </small>
            </div>
            <span t-att-class="'badge rounded-pill ' + ('bg-success' if p.workout_done else 'bg-secondary')">
              <t t-esc="'Tamamlandı' if p.workout_done else 'Beklemede'"/>
            </span>
          </a>
        </t>
      </div>
    </div>
  </t>
</template>

<!-- 



<template id="portal_workout_list" name="Diet: Workout List">
  <t t-call="portal.portal_layout">
    <div class="container py-4">
      <div class="d-flex align-items-center justify-content-between">
        <h3 class="mb-3">Sporum</h3>
        <a class="btn btn-link" href="/my/diet">← Diyetim</a>
      </div>

      <t t-if="not plans">
        <div class="alert alert-info">Gösterilecek antrenman bulunamadı.</div>
      </t>

      <div class="list-group">
        <t t-foreach="plans" t-as="p">
          <a t-attf-href="/my/diet/workout/#{p.id}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-semibold">
                <t t-esc="p.date"/> —
                <t t-esc="p.workout_id and p.workout_id.name or 'Spor tanımlı değil'"/>
              </div>
              <small class="text-muted">
                <t t-if="p.workout_id">
                  Süre: <t t-esc="p.workout_id.duration_min or 0"/> dk
                  • Zorluk: <t t-esc="p.workout_id.difficulty or '-'"/>
                </t>
                <t t-else="">
                  Lütfen antrenman seçiniz.
                </t>
              </small>
            </div>
            <span t-att-class="'badge rounded-pill ' + ('bg-success' if p.workout_done else 'bg-secondary')">
              <t t-esc="'Tamamlandı' if p.workout_done else 'Beklemede'"/>
            </span>
          </a>
        </t>
      </div>
    </div>
  </t>
</template>


-->




<!-- SPOR DETAY -->
<template id="portal_workout_detail" name="Diet: Workout Detail">
  <t t-call="portal.portal_layout">
    <div class="container py-4">
      <a t-attf-href="/my/diet/workouts" class="btn btn-link mb-3">← Tüm Antrenmanlar</a>

      <div class="d-flex align-items-center justify-content-between">
        <h3 class="mb-2">
          <t t-esc="plan.date"/> — 
          <t t-esc="workout and workout.name or 'Spor tanımlı değil'"/>
        </h3>
        <t t-if="workout">
          <form t-attf-action="/my/diet/workout/#{plan.id}/done" method="post" class="d-inline">
            <button t-att-class="'btn ' + ('btn-success disabled' if plan.workout_done else 'btn-primary')" t-att-disabled="plan.workout_done">
              <i class="fa fa-check me-1"/>
              <t t-esc="'Tamamlandı' if plan.workout_done else 'Tamamlandı işaretle'"/>
            </button>
          </form>
        </t>
      </div>

      <t t-if="not workout">
        <div class="alert alert-warning">Bu güne antrenman atanmadı.</div>
      </t>

      <t t-if="workout">
        <div class="row g-3">
          <div class="col-lg-4">
            <div class="card">
              <div class="card-body">
                <div><strong>Zorluk:</strong> <t t-esc="workout.difficulty or '-'"/></div>
                <div><strong>Süre:</strong> <t t-esc="workout.duration_min or 0"/> dk</div>
                <div><strong>Tahmini Kalori:</strong> <t t-esc="workout.kcal_burn or 0"/> kcal</div>
                <t t-if="workout.description">
                  <hr/>
                  <div class="text-muted" t-raw="workout.description"/>
                </t>
              </div>
            </div>
          </div>
          <div class="col-lg-8">
            <div class="card">
              <div class="card-body">
                <h5 class="mb-3">Egzersizler</h5>
                <t t-if="not workout.line_ids">
                  <div class="text-muted">Bu antrenman için egzersiz satırı yok.</div>
                </t>
                <t t-else="">
                  <div class="table-responsive">
                    <table class="table align-middle">
                      <thead>
                        <tr>
                          <th>Egzersiz</th>
                          <th>Set</th>
                          <th>Tekrar</th>
                          <th>Dinlenme</th>
                        </tr>
                      </thead>
                      <tbody>
                        <t t-foreach="workout.line_ids" t-as="l">
                          <tr>
                            <td><t t-esc="l.name or (l.exercise_id and l.exercise_id.name)"/></td>
                            <td><t t-esc="l.sets or '-'"/></td>
                            <td><t t-esc="l.reps or '-'"/></td>
                           
                          </tr>
                        </t>
                        
                      </tbody>
                    </table>
                  </div>
                </t>
              </div>
            </div>
          </div>
        </div>
      </t>
    </div>
  </t>
</template>

<template id="portal_forum_home" name="Diet: Forum Home">
  <t t-call="portal.portal_layout">
    <div class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">Forum &amp; Ortak Chat</h3>
        <a href="/my/diet" class="btn btn-link">← Diyetime Dön</a>
      </div>

      <!-- Ortak Chat -->
      <div class="card mb-4">
        <div class="card-header d-flex align-items-center">
          <i class="fa fa-comments me-2"></i> Ortak Chat
        </div>
        <div class="card-body" style="max-height: 380px; overflow-y: auto;">
          <t t-if="messages">
            <t t-foreach="messages" t-as="m">
              <div class="mb-2">
                <strong t-esc="m.author_id and m.author_id.name or 'Anonim'"/> :
                <span t-esc="m.body"/>
                <small class="text-muted ms-2" t-esc="m.create_date"/>
              </div>
            </t>
          </t>
          <t t-if="not messages">
            <div class="text-muted">Henüz mesaj yok.</div>
          </t>
        </div>
        <div class="card-footer">
          <form action="/my/diet/forum/chat/send" method="post" class="d-flex gap-2">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <input class="form-control" name="body" placeholder="Mesaj yaz..." maxlength="1000" required="required"/>
            <button class="btn btn-primary">
              <i class="fa fa-paper-plane me-1"/> Gönder
            </button>
          </form>
        </div>
      </div>

      <!-- Gönderiler -->
      <div class="row g-4">
        <div class="col-lg-7">
          <div class="card">
            <div class="card-header"><i class="fa fa-list me-2"></i> Son Gönderiler</div>
            <ul class="list-group list-group-flush">
              <t t-if="posts">
                <t t-foreach="posts" t-as="p">
                  <li class="list-group-item d-flex justify-content-between align-items-start">
                    <div class="me-3">
                      <a t-attf-href="/my/diet/forum/post/#{p.id}">
                        <strong t-esc="p.title"/>
                      </a>
                      <div class="small text-muted">
                        <t t-esc="p.author_id and p.author_id.name or 'Anonim'"/> ·
                        <t t-esc="p.create_date"/>
                        · <t t-esc="(len(p.comment_ids) or 0)"/> yorum
                      </div>
                    </div>
                    <a t-attf-href="/my/diet/forum/post/#{p.id}" class="btn btn-sm btn-outline-secondary">Görüntüle</a>
                  </li>
                </t>
              </t>
              <t t-if="not posts">
                <li class="list-group-item text-muted">Henüz gönderi yok.</li>
              </t>
            </ul>
          </div>
        </div>

        <div class="col-lg-5">
          <div class="card">
            <div class="card-header"><i class="fa fa-plus me-2"></i> Yeni Gönderi</div>
            <div class="card-body">
              <form action="/my/diet/forum/post/create" method="post">
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <div class="mb-3">
                  <label class="form-label">Başlık</label>
                  <input class="form-control" name="title" required="required" maxlength="200"/>
                </div>
                <div class="mb-3">
                  <label class="form-label">İçerik</label>
                  <textarea class="form-control" name="body" rows="5"></textarea>
                </div>
                <button class="btn btn-primary">
                  <i class="fa fa-save me-1"/> Yayınla
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

    </div>
  </t>
</template>
<template id="portal_forum_post" name="Diet: Forum Post Detail">
  <t t-call="portal.portal_layout">
    <div class="container py-4">
      <a href="/my/diet/forum" class="btn btn-link">← Foruma Dön</a>

      <div class="card mb-4">
        <div class="card-body">
          <h3 class="mb-2" t-esc="post.title"/>
          <div class="small text-muted mb-3">
            <t t-esc="post.author_id and post.author_id.name or 'Anonim'"/> · <t t-esc="post.create_date"/>
          </div>
          <div t-raw="post.body or ''"/>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><i class="fa fa-comments me-2"></i> Yorumlar</div>
        <ul class="list-group list-group-flush">
          <t t-if="post.comment_ids">
            <t t-foreach="post.comment_ids" t-as="c">
              <li class="list-group-item">
                <div class="small text-muted mb-1">
                  <strong t-esc="c.author_id and c.author_id.name or 'Anonim'"/> · <t t-esc="c.create_date"/>
                </div>
                <div t-esc="c.body"/>
              </li>
            </t>
          </t>
          <t t-if="not post.comment_ids">
            <li class="list-group-item text-muted">Henüz yorum yok.</li>
          </t>
        </ul>
        <div class="card-footer">
          <form t-attf-action="/my/diet/forum/post/#{ post.id }/comment" method="post" class="d-flex gap-2">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <input class="form-control" name="body" placeholder="Yorum yaz..." maxlength="1000" required="required"/>
            <button class="btn btn-primary">
              <i class="fa fa-paper-plane me-1"/> Gönder
            </button>
          </form>
        </div>
      </div>

    </div>
  </t>
</template>


  <!-- TARİF LİSTESİ -->
  <template id="portal_recipe_list" name="Diet: Recipe List">
    <t t-call="portal.portal_layout">
      <div class="container py-4">
        <a href="/my/diet" class="btn btn-link">← Geri</a>
        <h3>Tarifler</h3>
        <form class="mb-3" method="get" action="/my/diet/recipes">
          <div class="row g-2 align-items-end">
            <div class="col-auto">
              <label class="form-label">Tür</label>
              <select name="course" class="form-select">
                <option value="">Hepsi</option>
                <option value="salad" t-att-selected="course=='salad'">Salata</option>
                <option value="soup"  t-att-selected="course=='soup'">Çorba</option>
                <option value="meal"  t-att-selected="course=='meal'">Yemek</option>
                <option value="side"  t-att-selected="course=='side'">Yan Yiyecek</option>
              </select>
            </div>
            <div class="col-auto">
              <button class="btn btn-outline-primary">Filtrele</button>
            </div>
          </div>
        </form>
<!--eklentiyi ayırdım skimden aşşa kasımpaşa  -->
        <div class="row g-3">
          <t t-foreach="recipes" t-as="r">
            <div class="col-12 col-md-6 col-lg-4">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title" t-esc="r.name"/>
                  <p class="card-text text-muted">
                    <t t-esc="r.course"/> · <t t-esc="r.kcal or 0"/> kcal
                  </p>
                  <p class="small" t-esc="(r.description or '')[:120]"/>
                </div>
              </div>
            </div>
          </t>
          <t t-if="not recipes">
            <div class="text-muted">Tarif bulunamadı.</div>
          </t>
        </div>
      </div>
    </t>
  </template>

  <!-- ALIŞVERİŞ LİSTESİ -->
  <template id="portal_shopping_list" name="Diet: Shopping List">
    <t t-call="portal.portal_layout">
      <div class="container py-4">
        <a t-attf-href="/my/diet/period/#{period.id}" class="btn btn-link">← Geri</a>
        <h3>Alışveriş Listesi — <t t-esc="period.name"/></h3>
        <div class="card">
          <div class="card-header">Ürünler</div>
          <ul class="list-group list-group-flush">
            <t t-foreach="items" t-as="it">
              <li class="list-group-item d-flex justify-content-between">
                <span t-esc="it['name']"/>
                <span class="text-muted">
                  <t t-esc="it['qty']"/> <t t-esc="it['uom']"/>
                </span>
              </li>
            </t>
            <t t-if="not items">
              <li class="list-group-item text-muted">Liste boş.</li>
            </t>
          </ul>
        </div>
      </div>
    </t>
  </template>

</odoo>
